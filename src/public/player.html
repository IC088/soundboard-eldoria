<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wildlands Soundboard - Player View</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #2c1810 0%, #1a0f08 100%);
      color: #fff;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      padding: 30px 0;
      background: rgba(255, 180, 50, 0.1);
      border-radius: 15px;
      margin-bottom: 30px;
      border: 2px solid rgba(255, 180, 50, 0.3);
    }

    h1 {
      color: #ffb432;
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 0 0 20px rgba(255, 180, 50, 0.5);
    }

    .subtitle {
      color: rgba(255, 255, 255, 0.7);
      font-size: 1.1em;
    }

    .status {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-top: 15px;
    }

    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #4caf50;
      box-shadow: 0 0 10px #4caf50;
      animation: pulse 2s infinite;
    }

    .status-indicator.disconnected {
      background: #f44336;
      box-shadow: 0 0 10px #f44336;
      animation: none;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Volume Panel Styles */
    .volume-panel {
      background: rgba(30, 30, 30, 0.95);
      border: 2px solid rgba(255, 180, 50, 0.5);
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
      backdrop-filter: blur(10px);
    }

    .volume-panel h3 {
      margin: 0 0 20px 0;
      color: #ffb432;
      text-align: center;
      font-size: 1.3em;
    }

    .volume-control {
      margin-bottom: 20px;
      padding: 15px;
      background: rgba(50, 50, 50, 0.5);
      border-radius: 8px;
      transition: all 0.3s;
    }

    .volume-control:hover {
      background: rgba(60, 60, 60, 0.6);
    }

    .volume-control.master-volume {
      background: rgba(255, 180, 50, 0.1);
      border: 1px solid rgba(255, 180, 50, 0.3);
    }

    .volume-control label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      font-weight: bold;
      color: #fff;
    }

    .volume-label {
      font-size: 1em;
    }

    .volume-value {
      color: #ffb432;
      font-size: 1.1em;
      min-width: 50px;
      text-align: right;
    }

    .volume-control input[type="range"] {
      width: 100%;
      height: 8px;
      border-radius: 5px;
      background: rgba(100, 100, 100, 0.5);
      outline: none;
      -webkit-appearance: none;
    }

    .volume-control input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #ffb432;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(255, 180, 50, 0.5);
      transition: all 0.3s;
    }

    .volume-control input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #ffb432;
      cursor: pointer;
      border: none;
      box-shadow: 0 0 10px rgba(255, 180, 50, 0.5);
      transition: all 0.3s;
    }

    .volume-control input[type="range"]:hover::-webkit-slider-thumb {
      background: #ffc84d;
      box-shadow: 0 0 15px rgba(255, 180, 50, 0.8);
      transform: scale(1.1);
    }

    .volume-control input[type="range"]:hover::-moz-range-thumb {
      background: #ffc84d;
      box-shadow: 0 0 15px rgba(255, 180, 50, 0.8);
      transform: scale(1.1);
    }

    .volume-control small {
      display: block;
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.85em;
      margin-top: 5px;
    }

    .btn-secondary {
      width: 100%;
      margin-top: 10px;
      padding: 12px;
      background: rgba(100, 100, 100, 0.3);
      color: #fff;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 1em;
    }

    .btn-secondary:hover {
      background: rgba(100, 100, 100, 0.5);
      border-color: #ffb432;
      transform: translateY(-2px);
    }

    /* Now Playing Section */
    .now-playing {
      background: rgba(30, 30, 30, 0.8);
      border: 2px solid rgba(255, 180, 50, 0.3);
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
    }

    .now-playing h3 {
      color: #ffb432;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .track-item {
      background: rgba(50, 50, 50, 0.5);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .track-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #4caf50;
      box-shadow: 0 0 10px #4caf50;
      animation: pulse 1.5s infinite;
    }

    .track-info {
      flex: 1;
    }

    .track-name {
      font-weight: bold;
      margin-bottom: 5px;
    }

    .track-type {
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.9em;
    }

    .dm-volume {
      color: #ffb432;
      font-size: 0.9em;
    }

    .nothing-playing {
      text-align: center;
      padding: 40px;
      color: rgba(255, 255, 255, 0.5);
    }

    .nothing-playing-icon {
      font-size: 3em;
      margin-bottom: 10px;
    }

    footer {
      text-align: center;
      margin-top: 40px;
      padding: 20px;
      color: rgba(255, 255, 255, 0.5);
      font-size: 0.9em;
    }

    /* Info tooltip */
    .info-tooltip {
      background: rgba(255, 180, 50, 0.1);
      border: 1px solid rgba(255, 180, 50, 0.3);
      border-radius: 8px;
      padding: 15px;
      margin: 20px 0;
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.95em;
      line-height: 1.5;
    }

    .info-tooltip strong {
      color: #ffb432;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üéß Wildlands Soundboard</h1>
      <p class="subtitle">Player View</p>
      <div class="status">
        <div class="status-indicator" id="connection-status"></div>
        <span id="connection-text">Connecting...</span>
      </div>
    </header>

    <!-- Volume Controls -->
    <div id="player-volume-panel" class="volume-panel">
      <h3>üîä Your Volume Controls</h3>
      
      <div class="info-tooltip">
        <strong>üí° How it works:</strong> Your GM controls what plays and when. 
        You control how loud it is for you! Adjust the sliders below to your comfort level.
      </div>

      <!-- Master Volume -->
      <div class="volume-control master-volume">
        <label>
          <span class="volume-label">üéöÔ∏è Master Volume</span>
          <span class="volume-value" id="master-value">70%</span>
        </label>
        <input type="range" id="volume-master" min="0" max="100" value="70" step="1">
        <small>Controls all audio from your GM</small>
      </div>

      <!-- BGM Volume -->
      <div class="volume-control">
        <label>
          <span class="volume-label">üéµ Background Music</span>
          <span class="volume-value" id="bgm-value">100%</span>
        </label>
        <input type="range" id="volume-bgm" min="0" max="100" value="100" step="1">
        <small>Adjust music tracks independently</small>
      </div>

      <!-- Ambience Volume -->
      <div class="volume-control">
        <label>
          <span class="volume-label">üåä Ambience</span>
          <span class="volume-value" id="ambience-value">100%</span>
        </label>
        <input type="range" id="volume-ambience" min="0" max="100" value="100" step="1">
        <small>Adjust ambient sounds independently</small>
      </div>

      <!-- SFX Volume -->
      <div class="volume-control">
        <label>
          <span class="volume-label">‚ö° Sound Effects</span>
          <span class="volume-value" id="sfx-value">100%</span>
        </label>
        <input type="range" id="volume-sfx" min="0" max="100" value="100" step="1">
        <small>Adjust sound effects independently</small>
      </div>

      <button id="reset-volumes" class="btn-secondary">Reset All to Defaults</button>
    </div>

    <!-- Now Playing -->
    <div class="now-playing">
      <h3>üìª Now Playing</h3>
      <div id="now-playing-content">
        <div class="nothing-playing">
          <div class="nothing-playing-icon">üéµ</div>
          <p>Waiting for your GM to start audio...</p>
        </div>
      </div>
    </div>

    <footer>
      <p>üé≤ Wildlands Campaign Audio System</p>
      <p>Volume controls are saved to your browser</p>
    </footer>
  </div>

  <!-- Audio Elements -->
  <audio id="bgm-audio" loop></audio>
  <audio id="ambience-audio" loop></audio>

  <!-- Socket.IO -->
  <script src="/socket.io/socket.io.js"></script>
  
  <!-- Player Volume Control Script -->
  <script src="/player-volume-control.js"></script>

  <script>
    // Initialize Socket.IO connection
    const socket = io();
    let playerVolumeControl;

    // Track current playback
    const currentlyPlaying = {
      bgm: null,
      ambience: null
    };

    // Connection status
    socket.on('connect', () => {
      console.log('Connected to soundboard server');
      socket.emit('register', 'player');
      
      document.getElementById('connection-status').classList.remove('disconnected');
      document.getElementById('connection-text').textContent = 'Connected to GM';

      // Initialize player volume control
      playerVolumeControl = new PlayerVolumeControl(socket);
      
      // Update UI when volumes change
      setupVolumeListeners();
    });

    socket.on('disconnect', () => {
      console.log('Disconnected from soundboard server');
      document.getElementById('connection-status').classList.add('disconnected');
      document.getElementById('connection-text').textContent = 'Disconnected';
    });

    // Setup volume change listeners
    function setupVolumeListeners() {
      // These are handled by PlayerVolumeControl class
      // But we need to update the "Now Playing" display
      socket.on('bgm:play', updateNowPlaying);
      socket.on('bgm:stop', updateNowPlaying);
      socket.on('ambience:play', updateNowPlaying);
      socket.on('ambience:stop', updateNowPlaying);
      socket.on('master:stop', updateNowPlaying);
      socket.on('state:sync', (state) => {
        currentlyPlaying.bgm = state.bgm.playing ? state.bgm : null;
        currentlyPlaying.ambience = state.ambience.playing ? state.ambience : null;
        updateNowPlaying();
      });
    }

    // Update Now Playing display
    function updateNowPlaying() {
      const container = document.getElementById('now-playing-content');
      
      const bgm = currentlyPlaying.bgm;
      const ambience = currentlyPlaying.ambience;
      
      if (!bgm && !ambience) {
        container.innerHTML = `
          <div class="nothing-playing">
            <div class="nothing-playing-icon">üéµ</div>
            <p>Waiting for your GM to start audio...</p>
          </div>
        `;
        return;
      }

      let html = '';

      if (bgm && bgm.track) {
        html += `
          <div class="track-item">
            <div class="track-indicator"></div>
            <div class="track-info">
              <div class="track-name">üéµ ${bgm.track.name}</div>
              <div class="track-type">Background Music</div>
              <div class="dm-volume">GM Volume: ${Math.round(bgm.volume * 100)}%</div>
            </div>
          </div>
        `;
      }

      if (ambience && ambience.track) {
        html += `
          <div class="track-item">
            <div class="track-indicator"></div>
            <div class="track-info">
              <div class="track-name">üåä ${ambience.track.name}</div>
              <div class="track-type">Ambience</div>
              <div class="dm-volume">GM Volume: ${Math.round(ambience.volume * 100)}%</div>
            </div>
          </div>
        `;
      }

      container.innerHTML = html;
    }

    // Listen for BGM changes
    socket.on('bgm:play', (data) => {
      currentlyPlaying.bgm = data;
      updateNowPlaying();
    });

    socket.on('bgm:stop', () => {
      currentlyPlaying.bgm = null;
      updateNowPlaying();
    });

    // Listen for Ambience changes
    socket.on('ambience:play', (data) => {
      currentlyPlaying.ambience = data;
      updateNowPlaying();
    });

    socket.on('ambience:stop', () => {
      currentlyPlaying.ambience = null;
      updateNowPlaying();
    });

    // Master stop
    socket.on('master:stop', () => {
      currentlyPlaying.bgm = null;
      currentlyPlaying.ambience = null;
      updateNowPlaying();
    });
  </script>
</body>
</html>
